/*!
 * Colcade v0.2.0
 * Lightweight masonry layout
 * by David DeSandro
 * MIT license
 */
!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.Colcade=t()}(window,(function(){function e(e,t){if((e=l(e))&&e.colcadeGUID){var n=s[e.colcadeGUID];return n.option(t),n}this.element=e,this.options={},this.option(t),this.create()}var t=e.prototype;t.option=function(e){this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(this.options,e)};var n=0,s={};function o(t){var n=t.getAttribute("data-colcade").split(","),s={};n.forEach((function(e){var t=e.split(":"),n=t[0].trim(),o=t[1].trim();s[n]=o})),new e(t,s)}function i(e){var t=[];if(Array.isArray(e))t=e;else if(e&&"number"==typeof e.length)for(var n=0;n<e.length;n++)t.push(e[n]);else t.push(e);return t}function a(e,t){return i((t=t||document).querySelectorAll(e))}function l(e){return"string"==typeof e&&(e=document.querySelector(e)),e}return t.create=function(){this.errorCheck();var e=this.guid=++n;this.element.colcadeGUID=e,s[e]=this,this.reload(),this._windowResizeHandler=this.onWindowResize.bind(this),this._loadHandler=this.onLoad.bind(this),window.addEventListener("resize",this._windowResizeHandler),this.element.addEventListener("load",this._loadHandler,!0)},t.errorCheck=function(){var e=[];if(this.element||e.push("Bad element: "+this.element),this.options.columns||e.push("columns option required: "+this.options.columns),this.options.items||e.push("items option required: "+this.options.items),e.length)throw new Error("[Colcade error] "+e.join(". "))},t.reload=function(){this.updateColumns(),this.updateItems(),this.layout()},t.updateColumns=function(){this.columns=a(this.options.columns,this.element)},t.updateItems=function(){this.items=a(this.options.items,this.element)},t.getActiveColumns=function(){return this.columns.filter((function(e){return"none"!=getComputedStyle(e).display}))},t.layout=function(){this.activeColumns=this.getActiveColumns(),this._layout()},t._layout=function(){this.columnHeights=this.activeColumns.map((function(){return 0})),this.layoutItems(this.items)},t.layoutItems=function(e){e.forEach(this.layoutItem,this)},t.layoutItem=function(e){var t=Math.min.apply(Math,this.columnHeights),n=this.columnHeights.indexOf(t);this.activeColumns[n].appendChild(e),this.columnHeights[n]+=e.offsetHeight||1},t.append=function(e){var t=this.getQueryItems(e);this.items=this.items.concat(t),this.layoutItems(t)},t.prepend=function(e){var t=this.getQueryItems(e);this.items=t.concat(this.items),this._layout()},t.getQueryItems=function(e){e=i(e);var t=document.createDocumentFragment();return e.forEach((function(e){t.appendChild(e)})),a(this.options.items,t)},t.measureColumnHeight=function(e){var t=this.element.getBoundingClientRect();this.activeColumns.forEach((function(n,s){if(!e||n.contains(e)){var o=n.lastElementChild.getBoundingClientRect();this.columnHeights[s]=o.bottom-t.top}}),this)},t.onWindowResize=function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.onDebouncedResize()}.bind(this),100)},t.onDebouncedResize=function(){var e=this.getActiveColumns(),t=e.length==this.activeColumns.length,n=!0;this.activeColumns.forEach((function(t,s){n=n&&t==e[s]})),t&&n||(this.activeColumns=e,this._layout())},t.onLoad=function(e){this.measureColumnHeight(e.target)},t.destroy=function(){this.items.forEach((function(e){this.element.appendChild(e)}),this),window.removeEventListener("resize",this._windowResizeHandler),this.element.removeEventListener("load",this._loadHandler,!0),delete this.element.colcadeGUID,delete s[this.guid]},function(e){if("complete"==document.readyState)return void e();document.addEventListener("DOMContentLoaded",e)}((function(){a("[data-colcade]").forEach(o)})),e.data=function(e){var t=(e=l(e))&&e.colcadeGUID;return t&&s[t]},e.makeJQueryPlugin=function(t){function n(e,n,s){var o;return e.each((function(e,i){var a=t.data(i,"colcade");if(a){var l=a[n].apply(a,s);o=void 0===o?l:o}})),void 0!==o?o:e}function s(n,s){n.each((function(n,o){var i=t.data(o,"colcade");i?(i.option(s),i.layout()):(i=new e(o,s),t.data(o,"colcade",i))}))}(t=t||window.jQuery)&&(t.fn.colcade=function(e){if("string"==typeof e){var t=Array.prototype.slice.call(arguments,1);return n(this,e,t)}return s(this,e),this})},e.makeJQueryPlugin(),e}));let grid=document.querySelector('[data-js="grid"]');var colcade=new Colcade(grid,{columns:'[data-js="column"]',items:'[data-js="tile"]'});Object.prototype.removeItem=function(e){this.hasOwnProperty(e)&&(!isNaN(parseInt(e))&&this instanceof Array?this.splice(e,1):delete this[e])},document.addEventListener("DOMContentLoaded",(function(){let e=document.body,t=document.querySelector(".content"),n=document.querySelector('[data-js-modal="login"]'),s=document.querySelector('[data-js-modal="register"]'),o=document.querySelector('[data-js-modal="registerButton"]'),i=document.querySelector('[data-js-modal="loginButton"]'),a=document.querySelector('[data-js-modal="buttonLoginAlt"]'),l=document.querySelector('[data-js-modal="close"]'),c=document.querySelector('[data-js-modal="closeLogin"]');document.querySelector('[data-js-modal="loginForm"]'),document.querySelector('[data-js-modal="loginSubmitButton"]'),document.querySelector('[data-js-modal="loginResponse"]');void 0!==o&&null!=o&&o.addEventListener("click",(function(n){s.classList.add("js-modal--open"),e.style.setProperty("--js-scrollPosY",`-${window.scrollY}px`),e.classList.add("js-fixed"),t.classList.add("js-blur"),n.preventDefault()})),void 0!==i&&null!=i&&i.addEventListener("click",(function(s){n.classList.add("js-modal--open"),e.style.setProperty("--js-scrollPosY",`-${window.scrollY}px`),e.classList.add("js-fixed"),t.classList.add("js-blur"),s.preventDefault()})),void 0!==a&&null!=a&&a.addEventListener("click",(function(s){n.classList.add("js-modal--open"),e.style.setProperty("--js-scrollPosY",`-${window.scrollY}px`),e.classList.add("js-fixed"),t.classList.add("js-blur"),s.preventDefault()})),void 0!==l&&null!=l&&l.addEventListener("click",(function(o){const i=-1*parseInt(document.body.style.getPropertyValue("--js-scrollPosY")||0);n.classList.contains("js-modal--open")&&n.classList.remove("js-modal--open"),s.classList.contains("js-modal--open")&&s.classList.remove("js-modal--open"),e.classList.remove("js-fixed"),t.classList.remove("js-blur"),window.scrollTo(0,-1*parseInt(i||"0")),o.preventDefault()})),void 0!==c&&null!=c&&c.addEventListener("click",(function(o){const i=-1*parseInt(document.body.style.getPropertyValue("--js-scrollPosY")||0);n.classList.contains("js-modal--open")&&n.classList.remove("js-modal--open"),s.classList.contains("js-modal--open")&&s.classList.remove("js-modal--open"),e.classList.remove("js-fixed"),t.classList.remove("js-blur"),window.scrollTo(0,-1*parseInt(i||"0")),o.preventDefault()}));let r={};(window.onpopstate=function(){let e,t=/\+/g,n=/([^&=]+)=?([^&]*)/g,s=function(e){return decodeURIComponent(e.replace(t," "))},o=window.location.search.substring(1);for(;e=n.exec(o);)s(e[1])in r?(Array.isArray(r[s(e[1])])||(r[s(e[1])]=[r[s(e[1])]]),r[s(e[1])].push(s(e[2]))):r[s(e[1])]=s(e[2])})();let d=document.querySelector('[data-js="filtered-omen-list"]');function u(e){let t=document.querySelectorAll("[data-js-term-"+e+"]");t.forEach(n=>{n.addEventListener("click",s=>{s.preventDefault();let o=n.getAttribute("data-js-term-"+e);r[e]===o?(r.removeItem(e),n.classList.remove("tile__listItem--active")):(r[e]=o,t.forEach(e=>{e.classList.contains("tile__listItem--active")&&e.classList.remove("tile__listItem--active")}),n.classList.add("tile__listItem--active"));document.querySelectorAll("[data-js-breadcrumb]").forEach(e=>e.remove());for(const[e,t]of Object.entries(r)){let n=document.createElement("li");n.setAttribute("class","nav__link"),n.setAttribute("data-js-breadcrumb","taxonomy");let s=document.createTextNode("[ "+e+" : "+t+" ]");n.appendChild(s),document.querySelector('[data-js="breadcrumbs"]').appendChild(n)}let i=encodeURIComponent,a=Object.keys(r).map(e=>i(e)+"="+i(r[e])).join("&"),l="/omen/ajax/?"+a,c="/omen/?"+a;if(null==d)window.location.href="/omen/?"+a;else{let e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){window.history.replaceState({query:a},"",c);const e=`\n                                <div data-js="column" class="tile__panel__column g-span2of8"></div>\n                                <div data-js="column" class="tile__panel__column g-span2of8"></div>\n                                <div data-js="column" class="tile__panel__column g-span2of8"></div>\n                                <div data-js="column" class="tile__panel__column g-span2of8 g-last"></div>\n\n                                ${JSON.parse(this.responseText).map(e=>`\n                                <div data-js="tile" class="tile">\n                                    <a href="${e.path}">\n                                        <span class="tile__text  tile__text--title">${e.title}</span>\n                                        <span class="tile__text">${e.semanticDeath}</span>\n                                    </a>\n                                </div>\n                                `).join("")}\n                            `;colcade.destroy();let t=document.querySelector('[data-js="grid"]');t.innerHTML=e,colcade=new Colcade(t,{columns:'[data-js="column"]',items:'[data-js="tile"]'})}},e.open("GET",l,!0),e.send()}})})}u("aspect"),u("death"),u("fault");let m=document.querySelector('[data-js-searchForm="searchForm"]'),h=document.querySelector('[data-js-searchForm="searchBar"]'),p=document.querySelector('[data-js-searchForm="queryDisplay"]'),f=document.querySelector('[data-js="grid"]');const v=function(e){let t=e.target.value;p.innerHTML=t,r.query=t;let n=encodeURIComponent,s=Object.keys(r).map(e=>n(e)+"="+n(r[e])).join("&"),o="/search/ajax/?"+s,i="/search/?"+s,a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){window.history.replaceState({query:t},"",i);const e=`\n                    <div data-js="column" class="tile__panel__column g-span2of6"></div>\n                    <div data-js="column" class="tile__panel__column g-span2of6"></div>\n                    <div data-js="column" class="tile__panel__column g-span2of6 g-last"></div>\n\n                    ${JSON.parse(this.responseText).map(e=>`\n                        <div data-js="tile" class="tile">\n                            <a href="${e.path}">\n                                <span class="tile__text  tile__text--title">${e.title}</span>\n                                <span class="tile__text">${e.semanticDeath}</span>\n                            </a>\n                        </div>\n                        `).join("")}\n                `;f.innerHTML=e,colcade.destroy(),colcade=new Colcade(f,{columns:'[data-js="column"]',items:'[data-js="tile"]'})}},a.open("GET",o,!0),a.send()};h.addEventListener("input",v),h.addEventListener("propertychange",v),m.addEventListener("submit",(function(e){return e.preventDefault(),!1}))}));